<p id="notice"><%= notice %></p>

<p>
  <strong>Listing title:</strong>
  <%= @listing.listing_title %>
</p>

<p>
  <strong>Listing description:</strong>
  <%= @listing.listing_description %>
</p>

<p>
  <strong>Seller:</strong>
  <%= @listing.user_id %>
</p>

<p>
  <strong>Price:</strong>
  <%= @listing.price %>
</p>

<p>
  <strong>Condition:</strong>
  <%= @listing.condition %>
</p>

<p>
  <strong>Category:</strong>
  <%= Category.find(@listing.category_id).category_name %>
</p>

<% if @listing.photo.attached? %>
<p>
  <strong>Photo:</strong>
  <%= image_tag @listing.photo %>
</p>
<% end %>

<% if (@listing.sold == true) %>
  <p>Item has been sold.</p>
<% else %>
  <% if user_signed_in? %>
    <button data-stripe="payment">
      Buy Now
    </button> 
  <% else %>
    <%= button_to "Buy Now", new_user_registration_path, method: :get %>
  <% end %>
<% end %>


<script src="https://js.stripe.com/v3/"></script>

<script>
  document
    .querySelector("[data-stripe='payment']")
    .addEventListener("click", () => {
      const stripe = Stripe(
        "<%= Rails.application.credentials.dig(:stripe, :public_key) %>"
      )

      stripe.redirectToCheckout({
        sessionId: "<%= @session_id %>"
      })
    })
</script>

<% if current_user == @listing.user %>
<%= link_to 'Edit', edit_listing_path(@listing) %> |
<%= link_to 'Delete', listing_path(@listing),
       method: :delete,
          data: { confirm: "Are you sure?" } %> |
<% end %>
<%= link_to 'Back', listings_path %>
